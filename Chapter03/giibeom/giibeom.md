# Chapter 3. 사용자 및 권한

### 사용자

- MySQL 사용자는 계정 + 접속 지점(호스트명 or 도메인 or IP 주소)로 사용
- 따라서 계정을 언급할 때도 항상 아이디와 호스트를 함께 명시해야 함
    - `'alex'@'127.0.0.1'`
- % 문자는 모든 IP 또는 모든 호스트명을 의미
- 권한이나 계정 정보에 대해 MySQL은 범위가 가장 작은 것을 항상 먼저 선택
    - IP 주소가 192.168.0.10인 PC에서 MySQL 서버를 접속할 때
    - `'alex'@'192.168.0.10'`로 사용할 지?  → 좁은 범위인 얘를 사용
    - `'alex'@'%'`로 사용할 지?

<br>

### 사용자 계정 관리

- 시스템 계정 : SYSTEM_USER 권한을 가진 계정
    - 데이터베이스 서버 관리자를 위한 계정
    - 따라서 데이터베이스 서버 관리와 관련된 중요 작업은 시스템 계정으로만 수정 가능
        - 계정 관리(계정 생성 및 삭제, 계정의 권한 부여 및 제거)
        - 다른 세션 또는 그 세션에서 실행 중인 쿼리를 강제 종료
        - 스토어드 프로그램 생성 시 DEFINER를 타 사용자로 설정
    - 시스템 계정과 일반 계정을 관리(생성 삭제 및 변경) 가능
- 일반 계정 : SYSTEM_USER 권한을 가지지 않은 계정
    - 응용 프로그램이나 개발자를 위한 계정

<br>

### 비밀 번호

- `PASSWORD EXPIRE` : 비밀번호의 유효 기간을 설정 가능
- `PASSWORD HISTORY` : 한번 사용했던 비밀번호를 재 사용하지 못하게 설정 가능
- `PASSWORD REUSE INTERVAL` : 한 번 사용했던 비밀번호의 재사용 금지 기간을 설정 가능
- `PASSWORD REQUIRE` : 비밀번호 만료 시 새로운 비밀번호로 변경할 때 현재 비밀번호 필요로 할지 여부 설정 가능
- `ACCOUNT LOCK / UNLOCK` : 계정 생성 또는 수정 시 계정을 잠글지 풀지 설정 가능
- `RETAIN CURRENT PASSWORD` : MySQL 8.0부터 계정의 비밀번호로 2개의 값을 동시에 사용할 수 있게 기능 추가됨
    - 비밀번호는 서비스가 실행 중인 상태에서 변경이 불가능했음
    - 따라서 서비스를 중단시키지 않아도 변경할 수 있게 하기 위해 세컨더리 비밀번호 설정 가능

### 권한

- 글로벌 권한 : 데이터베이스나 테이블 이외에 객체 적용되는 권한
- 객체 권한 : 데이터베이스나 테이블을 제어하는데 필요한 권한
- 정적 권한 : MySQL 서버의 소스 코드에 고정적으로 명시돼 있는 권한
- 동적 권한 : MySQL 서버가 시작되면서 동적으로 생성하는 권한 (일부는 MySQL 서버에 명시)
    - MySQL 8.0에서 SUPER 권한을 잘게 쪼개어져 동적 권한으로 분산
    - 이로써 백업 관리자와 복제 관리자 개별로 권한 부여 가능 (꼭 필요한 권한만 부여)
- 특정 DB나 테이블, 컬럼에 대해서도 부분적으로만 권한 할당이 가능하다
    - 칼럼의 부여할 수 있는 권한은 DELETE를 제외한 INSERT, UPDATE, SELECT 3가지이다
    - 하지만 테이블이나 칼럼 단위의 권한은 잘 사용하지 않는다
    - 칼럼 단위의 권한이 하나라도 설정되면 나머지 모든 테이블의 모든 칼럼에 대해서도 권한 체크를 하기 때문에 전체적인 성능에 영향을 미칠 수 있다
    - 따라서 칼럼 단위의 접근 권한이 꼭 필요하다면 별도의 뷰(VIEW)를 만들자
        - 뷰는 하나의 테이블로 인식되기 때문에 뷰의 칼럼에 대한 권한을 체크하지 않고 뷰 자체에 대한 권한만 체크할 수 있어 전체적인 성능에 영향을 안미친다

<br>

### 역할

- 역할 생성 → 역할에 권한 할당(grant) → 사용자에 역할 할당
- 역할과 사용자 계정은 mYsql 서버 내부적으로 동일한 객체로 취급 됨
    - 단지 CREATE ROLE로 역할을 생성하면 account_locked=Y가 되어 로그인이 불가능한 계정 잠금 상태가 되는 것이다
    - 따라서 CREATE ROLE 과 CREATE USER는 같은 계정을 생성하지만 계정 잠금 상태를 다르게 하는 차이이다
    - 그러므로 헷갈리지 않게 관리자가 식별할 수 있는 prefix나 키워드를 추가해서 서로 구분지어주자
- 역할을 생성하여 사용자에게 부여해도 SET ROLE 명령을 실행하지 않는다면 권한이 적용되지 않는다
    - 일일히 SET ROLE 명령어를 입력하기 귀찮으니, MySQL 서버에 로그인 시 역할을 자동으로 활성화할 수 있는 `activate_all_roles_on_login` 시스템 변수를 설정해주자
    - `SET GLOBAL activate_all_roles_on_login=ON;`
